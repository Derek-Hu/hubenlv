---
category: javascript
tag: javascript, performance
---

RAIL 是一种以用户为中心的性能模型，代表着**响应**(Response), **动画**(Animation),**空闲时间**(Idle)和**资源加载**(Load)四个方面，简称为RAIL, 这四个指标反映着页面的不同性能。
<img src="/rail.png" />
# 以用户为中心
> 最终目标不是让您的网站在任何特定设备上都能运行很快，而是使用户满意。

性能的改进是为了提高用户体验，用户访问网站时不应该把时间浪费在页面的加载过程中。延迟越高则体验越差，以下是延迟时间与用户感受的比对表格：

| 延迟时间 |用户感受及反应|
| ------------- |:-------------:|
| 0 - 16 毫秒| 人们对于运动的事物比较敏感，如果动画不流畅，他们就会对运动心生反感。 用户可以感知每秒渲染 60 帧的平滑动画转场。**即应用程序必须在16 毫秒（每帧 1000毫秒/60帧）内在浏览器中，将新的一帧绘制到屏幕上**，否则用户会感觉动画有所卡顿，也就是留给应用程序大约 10 毫秒的时间来生成一帧。 |
| 0 - 100 毫秒      | 在100毫秒内响应用户操作，用户会感觉比较流畅。      |
| 100 - 300 毫秒 | 用户会遇到轻微可觉察的延迟      |
| 300 - 1000 毫秒 | 在此窗口内，延迟感觉像是任务自然和持续发展的一部分。对于网络上的大多数用户，加载页面或更改视图代表着一个任务。      |
| 1秒以上 |超过1秒，用户的会分散注意力。      |
| 10秒以上 | 用户感到失望，可能会放弃任务；之后他们或许不会再回来。 |

# 响应：在 100 毫秒以内响应

响应时间超过100毫秒，用户则会感觉到延迟的存在，比如点击按钮、切换表单控件或者启动动画。不过用户对于触摸拖动以及滚动操作的延迟感觉不会那么明显。

虽然立即响应用户的操作是最佳实践，但不一定非得这么做，我们可以利用这100毫秒的窗口期，执行其他开销大的工作，但需要小心处理，以免阻塞用户的操作。如果可以，尽量在后台执行这些操作。

对于需要超过 500 毫秒才能完成的操作，一般需要给予用户一定的反馈，比如处理中的提示效果等。

# 动画：在 10 毫秒内生成一帧动画

动画不仅仅是酷炫的的 UI 效果，也包括滚动和触摸拖动等动画类型。

如果动画帧率发生变化，用户确实会注意到。我们的目标是每秒生成 60 帧，并且每一帧都必须完成以下所有步骤：

从纯粹的数学角度而言，每帧的预算约为 16 毫秒（1000 毫秒 / 60 帧 = 16.66 毫秒/帧）。 但因为浏览器需要花费时间将新帧绘制到屏幕上，实际上大约只有 10 毫秒来执行代码。
<img src="/render-frame.png" />
更多信息，可以查看**渲染性能**

# 空闲：最大程度增加空闲时间

尽可能减少预加载的数据，使得的应用快速加载并启动，并利用空闲时间加载剩余数据。

推迟的工作应分成每个耗时约 50 毫秒的多个块。如果用户开始交互，优先级最高的事项是响应用户。

要实现小于 100 毫秒的响应，应用必须在每 50 毫秒内将控制返回给主线程，这样应用就可以执行其像素管道、对用户输入作出反应等等。

以 50 毫秒块工作既可以完成任务，又能确保即时的响应。

# 加载：在 1000 毫秒以内呈现内容

在 1 秒钟内加载您的网站。否则，用户的注意力会分散，他们处理任务的感觉会中断。

重点**优化关键渲染路径**。

您无需在 1 秒内加载所有内容以产生完整加载的感觉。启用渐进式渲染和在后台执行一些工作。将非必需的加载推迟到空闲时间段。

# 关键 RAIL 指标汇总

|RAIL 步骤|关键指标|用户操作|
|------------- |:-------------:|:-------------:|
|响应|输入延迟时间（从点按到绘制）小于 100 毫秒。|用户点按按钮（例如打开导航）|
|动画|每个帧的工作（从 JS 到绘制）完成时间小于 16 毫秒。|用户滚动页面，拖动手指（例如，打开菜单）或看到动画。 拖动时，应用的响应与手指位置有关（例如，拉动刷新、滑动轮播）。 此指标仅适用于拖动的持续阶段，不适用于开始阶段。|
|空闲|主线程 JS 工作分成不大于 50 毫秒的块。|用户没有与页面交互，但主线程应足够用于处理下一个用户输入。|
|加载|页面可以在 1000 毫秒内就绪。|用户加载页面并看到关键路径内容。|
